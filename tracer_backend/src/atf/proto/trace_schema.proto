syntax = "proto3";

import "google/protobuf/timestamp.proto";

message Event {
  uint64 event_id = 1;
  int32 thread_id = 2;
  google.protobuf.Timestamp timestamp = 3;

  oneof payload {
    TraceStart trace_start = 10;
    TraceEnd trace_end = 11;
    FunctionCall function_call = 12;
    FunctionReturn function_return = 13;
    SignalDelivery signal_delivery = 14;
  }
}

message TraceStart {
  string executable_path = 1;
  repeated string args = 2;
  string operating_system = 3;
  string cpu_architecture = 4;
}

message TraceEnd {
  int32 exit_code = 1;
}

message FunctionCall {
  string symbol = 1;
  uint64 address = 2;
  map<string, uint64> argument_registers = 3;
  bytes stack_shallow_copy = 4;
}

message FunctionReturn {
  string symbol = 1;
  uint64 address = 2;
  map<string, uint64> return_registers = 3;
}

message SignalDelivery {
  int32 number = 1;
  string name = 2;
  map<string, uint64> registers = 3;
}
